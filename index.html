<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Soundboard Login</title>
    <style>
        body { font-family: sans-serif; display: grid; place-items: center; min-height: 100vh; }
        button { font-size: 1.2rem; padding: 10px 20px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="login-section">
        <h1>Spotify Soundboard</h1>
        <button id="loginButton">Login with Spotify</button>
    </div>

    <div id="app-section" style="display: none;">
        <h2>Welcome to your Soundboard!</h2>
        <p>You are successfully logged in.</p>
        <pre id="token-display" style="word-wrap: break-word;"></pre>
    </div>

    <script>
        // --- 1. Configuration ---
        const clientId = 'bb82c1e306e44bc681b5fc345b2b493f';
        const redirectUri = 'https://valo-valox.github.io/spotify-soundboard/';
        
        // Define the "scopes" your app needs.
        // 'streaming' is required for the Web Playback SDK.
        const scopes = [
            'streaming',
            'user-read-playback-state',
            'user-modify-playback-state',
            'user-read-private',
            'user-read-email'
        ];

        // --- 2. Page Load Logic ---
        window.addEventListener('load', () => {
            // Check if there's an access token in the URL hash
            const token = getAccessTokenFromHash();
            
            if (token) {
                // User is logged in
                console.log('Access Token:', token);
                showApp(token);
            } else {
                // User needs to log in
                showLogin();
            }

            // Bind the login button
            document.getElementById('loginButton').addEventListener('click', redirectToSpotifyLogin);
        });

        // --- 3. Authentication Functions ---

        function redirectToSpotifyLogin() {
            // Construct the Spotify authorization URL
            let url = 'https://accounts.spotify.com/authorize';
            url += '?response_type=token'; // Use 'token' for Implicit Grant
            url += '&client_id=' + encodeURIComponent(clientId);
            url += '&scope=' + encodeURIComponent(scopes.join(' '));
            url += '&redirect_uri=' + encodeURIComponent(redirectUri);
            
            // Redirect the user to the Spotify login page
            window.location = url;
        }

        function getAccessTokenFromHash() {
            // Parse the hash fragment from the URL
            const hash = window.location.hash
                .substring(1) // Remove the '#'
                .split('&')
                .reduce((initial, item) => {
                    if (item) {
                        let parts = item.split('=');
                        initial[parts[0]] = decodeURIComponent(parts[1]);
                    }
                    return initial;
                }, {});
            
            // Clear the hash from the URL so we don't try to re-login
            window.location.hash = '';

            // Return the access token if it exists
            return hash.access_token;
        }

        // --- 4. UI Functions ---

        function showLogin() {
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('app-section').style.display = 'none';
        }

        function showApp(token) {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('app-section').style.display = 'block';
            // Display the token (for testing)
            document.getElementById('token-display').textContent = 'Your Token: ' + token;
            
            // 
            // ** This is where you would initialize your app **
            // For example, initialize the Spotify Web Playback SDK:
            // 
            // window.onSpotifyWebPlaybackSDKReady = () => {
            //   const player = new Spotify.Player({
            //     name: 'My Soundboard',
            //     getOAuthToken: cb => { cb(token); }
            //   });
            //   // ... add player event listeners ...
            //   player.connect();
            // };
            //
        }
    </script>
</body>
</html>
